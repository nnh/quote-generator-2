<script type="text/javascript">
</script>
<script type="importmap">
  {
    "imports": {
      "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
    }
  }
</script>
<script type="module">
  import { createApp } from 'vue'
  const taxRate = 0.1;
  const defaultFinalAnalysisTables = 50;
  const defaultCrfItems = 1000;
  const defaultTitle = '概算見積算定フォーム';
  const defaultCoefficient = {value: 'publicFund', label:'公的資金（税金由来）'};
  const defaultTrialType = {value: 'observationalTrial', label: '観察研究・レジストリ'};
  createApp({
    data() {
      return {
        title: defaultTitle,
        taxRate: taxRate,
        itemsList: '',
        radioCoefficient: [
          defaultCoefficient,
          {value: 'commercialCompanyCoefficient', label:'営利企業原資（製薬企業等）'}
        ],
        checkCoefficient:defaultCoefficient.value,
        radioTrialType: [
          defaultTrialType, 
          {value: 'investigatorInitiatedTrial', label:'医師主導治験'}, 
          {value: 'interventionTrial', label:'介入研究（特定臨床研究以外）'}, 
          {value: 'specifiedClinicalTrial', label:'特定臨床研究'} 
        ],
        checkTrialType: defaultTrialType.value,
        textBoxCommon: [
          {id:'number_of_cases', label:'目標症例数', unit:'症例', value: 0, type:'number'},
          {id:'facilities', label:'実施施設数', unit:'施設', value: 0, type:'number'},
          {id:'number_of_crf_items', label:'CRF項目数', unit:'項目', value: defaultCrfItems, type:'number'},
          {id:'final_analysis_tables', label:'統計解析に必要な図表数', unit:'項目', value: defaultFinalAnalysisTables, type:'number'}
        ],
        dateYmList: [
          {id: 'start', label: '症例登録開始年月', year: '', month: '', labelMonth:[4, 10]},
          {id: 'end', label: '試験終了年月', year: '', month: '', labelMonth:[3, 9]}
        ]
      }
    },
    created() {
      this.editOutputTable();
    },
    methods: {
      async editOutputTable() {
        const items = await new Promise(resolve => { google.script.run.withSuccessHandler(resolve).getItemsList() });
        this.setItems(items);
      }, 
      setItems(target) {
        this.itemsList = target;
      },
      onSubmitApproximateQuote() {
//        this.editOutputTable();
        this.title = this.targetYears;
      },
      checkNumber(target) {
        return Number.isNaN(Number(target));
      }
    },
    computed: {
      getThisYear: function() {
        return new Date().getFullYear();
      },
      getYearList: function() {
        const thisYear = this.getThisYear;
        const pastYears = [...Array(2).keys()].map(x => thisYear - x - 1).reverse();
        const nextYears = [...Array(10).keys()].map(x => thisYear + x);
        return pastYears.concat(nextYears);
      }
    }
  }).mount('#app')
</script>